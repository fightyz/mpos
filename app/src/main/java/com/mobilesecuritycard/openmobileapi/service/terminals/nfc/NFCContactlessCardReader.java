package com.mobilesecuritycard.openmobileapi.service.terminals.nfc;import android.nfc.Tag;import android.nfc.tech.*;import android.util.Log;import java.io.IOException;public class NFCContactlessCardReader{	private Tag mTag;	private static NFCContactlessCardReader mSelf;	private IsoDep mIsoDep;	private String TAG = "ContactlessNFCTerminal";	public static NFCContactlessCardReader getInstance() {		if (null == mSelf) {			mSelf = new NFCContactlessCardReader();		}		return mSelf;	}		private NFCContactlessCardReader(){	}	public void open(){		Log.v(TAG, "pboc open ready" + (mIsoDep == null ? " null" : " not null"));		if (null != mIsoDep && (!mIsoDep.isConnected())) {			try {				Log.v(TAG, "pboc connect ready");				mIsoDep.connect();				Log.v(TAG, "pboc settimeout ready");				mIsoDep.setTimeout(10000);				Log.v(TAG, "pboc success");			} catch (IOException e) {				// TODO Auto-generated catch block				Log.v(TAG, "pboc failed!");				e.printStackTrace();			}		}	}	public void close() {		if (null != mIsoDep && mIsoDep.isConnected()) {			try {				mIsoDep.close();			} catch (IOException e) {				// TODO Auto-generated catch block				e.printStackTrace();			}		}	}	public byte[] transmit(byte[] command) throws IOException {		Log.v(TAG, "pboc transmit ready" + mIsoDep.toString());		byte result[] = null;		if (null == mIsoDep || !mIsoDep.isConnected()) {			throw new IOException("未检测到银行卡！");		}		Log.v(TAG, "pboc transmit start");		try {			result = mIsoDep.transceive(command);			Log.v(TAG, "pboc transmit success!");		} catch (IOException e) {			e.printStackTrace();			Log.v(TAG, "pboc transmit failed!");			throw e;		}		return result;	}	public void setTag(Tag tag) {		Log.v(TAG, "pboc settag ready");		mTag = tag;		try {			if(mIsoDep != null)mIsoDep.close();			mIsoDep = IsoDep.get(mTag);			Log.v(TAG, "pboc settag finish" + (mIsoDep == null ? " null" : " not null"));			Log.v(TAG,"pboc settag successed!");		} catch (IOException e) {			// TODO Auto-generated catch block			Log.v(TAG,"pboc settag failed!");			e.printStackTrace();		}	}	public boolean isConnect() {		if (null == mIsoDep) {			return false;		} else {			return  mIsoDep.isConnected();		}	}}